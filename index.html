<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Sigra - Gesti√≥n de Conductores</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button { margin: 5px; padding: 5px; }
    .hidden { display: none; }
  </style>
</head>
<body onload="initApp()">

  <h1>üöñ Sistema Sigra</h1>

  <!-- Registro -->
  <div id="registerSection">
    <h2>Registro</h2>
    <input type="text" id="regEmail" placeholder="Correo"><br>
    <input type="password" id="regPass" placeholder="Contrase√±a"><br>
    <label>
      <input type="checkbox" id="regTerms"> Acepto los T√©rminos y Condiciones
    </label><br>
    <button onclick="register()">Registrarse</button>
  </div>

  <!-- Login -->
  <div id="loginSection">
    <h2>Iniciar Sesi√≥n</h2>
    <input type="text" id="loginEmail" placeholder="Correo"><br>
    <input type="password" id="loginPass" placeholder="Contrase√±a"><br>
    <button onclick="login()">Entrar</button>
  </div>

  <!-- Panel principal -->
  <div id="mainSection" class="hidden">
    <h2>Bienvenido</h2>
    <p id="userInfo"></p>
    <button onclick="logout()">Cerrar Sesi√≥n</button>

    <!-- Combustible -->
    <div id="fuelSection">
      <h3>Precios de Combustible</h3>
      
      <!-- Solo visible para admin autorizado -->
      <div id="fuelAdmin" style="display:none;">
        <input type="number" id="price95" placeholder="Precio Gasolina 95">
        <input type="number" id="price90" placeholder="Precio Gasolina 90">
        <input type="number" id="pricediesel" placeholder="Precio Diesel">
        <button onclick="saveFuelPrice()">Guardar Precio</button>
      </div>

      <!-- Visible para todos -->
      <div id="fuelList"></div>
    </div>
  </div>

  <script>
    // Utilidades JSON en localStorage
    function readJSON(key){return JSON.parse(localStorage.getItem(key)||"[]");}
    function writeJSON(key,val){localStorage.setItem(key,JSON.stringify(val));}
    function getFuelKey(email){return "fuel_"+email;}

    // Registro
    function register(){
      const email=document.getElementById('regEmail').value.trim();
      const pass=document.getElementById('regPass').value.trim();
      const terms=document.getElementById('regTerms').checked;
      if(!email||!pass){alert("Completa todos los campos");return;}
      if(!terms){alert("Debes aceptar los T√©rminos y Condiciones");return;}
      let users=readJSON("sigra_users");
      if(users.find(u=>u.email===email)){alert("El usuario ya existe");return;}
      users.push({email:email,pass:pass});
      writeJSON("sigra_users",users);
      alert("‚úÖ Registro exitoso");
      document.getElementById('regEmail').value='';
      document.getElementById('regPass').value='';
      document.getElementById('regTerms').checked=false;
    }

    // Login
    function login(){
      const email=document.getElementById('loginEmail').value.trim();
      const pass=document.getElementById('loginPass').value.trim();
      let users=readJSON("sigra_users");
      const user=users.find(u=>u.email===email && u.pass===pass);
      if(!user){alert("Credenciales incorrectas");return;}
      localStorage.setItem("sigra_current",email);
      showMain();
    }

    // Logout
    function logout(){
      localStorage.removeItem("sigra_current");
      location.reload();
    }

    // Mostrar secci√≥n principal
    function showMain(){
      const email=localStorage.getItem("sigra_current");
      document.getElementById("registerSection").style.display="none";
      document.getElementById("loginSection").style.display="none";
      document.getElementById("mainSection").classList.remove("hidden");
      document.getElementById("userInfo").innerText="Usuario: "+email;
      toggleFuelSection();
    }

    // Combustible
    function saveFuelPrice(){
      const email=localStorage.getItem('sigra_current');
      if(email !== "Hiroemiya1412@gmail.com"){
        alert("‚ùå Solo el usuario autorizado puede guardar precios de combustible.");
        return;
      }
      const p95=parseFloat(document.getElementById('price95').value)||0;
      const p90=parseFloat(document.getElementById('price90').value)||0;
      const pd=parseFloat(document.getElementById('pricediesel').value)||0;
      if(!p95&&!p90&&!pd){alert("Ingresa al menos un precio");return}
      const key=getFuelKey("Hiroemiya1412@gmail.com");
      const arr=readJSON(key);
      const item={fecha:new Date().toISOString(),g95:p95,g90:p90,diesel:pd};
      arr.push(item);
      writeJSON(key,arr);
      document.getElementById('price95').value='';
      document.getElementById('price90').value='';
      document.getElementById('pricediesel').value='';
      loadFuelPrices();
      alert("‚úÖ Precio guardado");
    }

    function loadFuelPrices(){
      const arr=readJSON(getFuelKey("Hiroemiya1412@gmail.com"));
      const div=document.getElementById('fuelList');
      div.innerHTML='';
      if(arr.length>0){
        const f=arr[arr.length-1]; // √∫ltimo precio
        div.innerHTML=`<div><b>√öltimo precio (${f.fecha.split("T")[0]}):</b><br>
          G95=${f.g95}, G90=${f.g90}, Diesel=${f.diesel}</div>`;
      }else{
        div.innerHTML="<i>No hay precios registrados a√∫n.</i>";
      }
    }

    function toggleFuelSection(){
      const email=localStorage.getItem('sigra_current');
      const adminSection=document.getElementById("fuelAdmin");
      if(email === "Hiroemiya1412@gmail.com"){
        adminSection.style.display="block";
      }else{
        adminSection.style.display="none";
      }
      loadFuelPrices();
    }

    // Inicializaci√≥n
    function initApp(){
      const email=localStorage.getItem("sigra_current");
      if(email){showMain();}
    }
  </script>
</body>
</html>
